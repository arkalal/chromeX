/*! For license information please see background.js.LICENSE.txt */
(()=>{function t(){var n,r,o="function"==typeof Symbol?Symbol:{},i=o.iterator||"@@iterator",a=o.toStringTag||"@@toStringTag";function c(t,o,i,a){var c=o&&o.prototype instanceof u?o:u,f=Object.create(c.prototype);return e(f,"_invoke",function(t,e,o){var i,a,c,u=0,f=o||[],l=!1,p={p:0,n:0,v:n,a:h,f:h.bind(n,4),d:function(t,e){return i=t,a=0,c=n,p.n=e,s}};function h(t,e){for(a=t,c=e,r=0;!l&&u&&!o&&r<f.length;r++){var o,i=f[r],h=p.p,v=i[2];t>3?(o=v===e)&&(c=i[(a=i[4])?5:(a=3,3)],i[4]=i[5]=n):i[0]<=h&&((o=t<2&&h<i[1])?(a=0,p.v=e,p.n=i[1]):h<v&&(o=t<3||i[0]>e||e>v)&&(i[4]=t,i[5]=e,p.n=v,a=0))}if(o||t>1)return s;throw l=!0,e}return function(o,f,v){if(u>1)throw TypeError("Generator is already running");for(l&&1===f&&h(f,v),a=f,c=v;(r=a<2?n:c)||!l;){i||(a?a<3?(a>1&&(p.n=-1),h(a,c)):p.n=c:p.v=c);try{if(u=2,i){if(a||(o="next"),r=i[o]){if(!(r=r.call(i,c)))throw TypeError("iterator result is not an object");if(!r.done)return r;c=r.value,a<2&&(a=0)}else 1===a&&(r=i.return)&&r.call(i),a<2&&(c=TypeError("The iterator does not provide a '"+o+"' method"),a=1);i=n}else if((r=(l=p.n<0)?c:t.call(e,p))!==s)break}catch(t){i=n,a=1,c=t}finally{u=1}}return{value:r,done:l}}}(t,i,a),!0),f}var s={};function u(){}function f(){}function l(){}r=Object.getPrototypeOf;var p=[][i]?r(r([][i]())):(e(r={},i,function(){return this}),r),h=l.prototype=u.prototype=Object.create(p);function v(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,l):(t.__proto__=l,e(t,a,"GeneratorFunction")),t.prototype=Object.create(h),t}return f.prototype=l,e(h,"constructor",l),e(l,"constructor",f),f.displayName="GeneratorFunction",e(l,a,"GeneratorFunction"),e(h),e(h,a,"Generator"),e(h,i,function(){return this}),e(h,"toString",function(){return"[object Generator]"}),(t=function(){return{w:c,m:v}})()}function e(t,n,r,o){var i=Object.defineProperty;try{i({},"",{})}catch(t){i=0}e=function(t,n,r,o){if(n)i?i(t,n,{value:r,enumerable:!o,configurable:!o,writable:!o}):t[n]=r;else{var a=function(n,r){e(t,n,function(t){return this._invoke(n,r,t)})};a("next",0),a("throw",1),a("return",2)}},e(t,n,r,o)}function n(t,e,n,r,o,i,a){try{var c=t[i](a),s=c.value}catch(t){return void n(t)}c.done?e(s):Promise.resolve(s).then(r,o)}function r(t){return function(){var e=this,r=arguments;return new Promise(function(o,i){var a=t.apply(e,r);function c(t){n(a,o,i,c,s,"next",t)}function s(t){n(a,o,i,c,s,"throw",t)}c(void 0)})}}var o="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";function i(){return(i=r(t().m(function e(n){var r,i,a,c;return t().w(function(t){for(;;)switch(t.n){case 0:if(t.p=0,o){t.n=1;break}throw new Error("API key not configured");case 1:return t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify(n)});case 2:if((r=t.v).ok){t.n=4;break}return t.n=3,r.json();case 3:throw a=t.v,new Error((null===(i=a.error)||void 0===i?void 0:i.message)||"API error: ".concat(r.status));case 4:return t.a(2,r);case 5:throw t.p=5,c=t.v,console.error("Error calling OpenAI API:",c),c;case 6:return t.a(2)}},e,null,[[0,5]])}))).apply(this,arguments)}function a(){return a=r(t().m(function e(n){var r,i,a,c,s,u=arguments;return t().w(function(t){for(;;)switch(t.n){case 0:return"",i=(r=u.length>1&&void 0!==u[1]?u[1]:"")?n.toLowerCase().includes("restyle")||n.toLowerCase().includes("tone")||n.toLowerCase().includes("style")?"Restyle the following text based on this instruction: ".concat(n,"\n\nOriginal text: ").concat(r):"Refine the following text based on this instruction: ".concat(n,"\n\nOriginal text: ").concat(r):"Write the following: ".concat(n),t.p=1,t.n=2,fetch("https://api.openai.com/v1/chat/completions",{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(o)},body:JSON.stringify({model:"gpt-4o",messages:[{role:"system",content:"You are a helpful writing assistant that improves text based on user instructions."},{role:"user",content:i}],max_tokens:1e3})});case 2:return a=t.v,t.n=3,a.json();case 3:if(!(c=t.v).error){t.n=4;break}throw new Error(c.error.message||"OpenAI API error");case 4:return t.a(2,c.choices[0].message.content.trim());case 5:throw t.p=5,s=t.v,console.error("OpenAI API error:",s),new Error("Failed to communicate with OpenAI API: "+s.message);case 6:return t.a(2)}},e,null,[[1,5]])})),a.apply(this,arguments)}chrome.runtime.onMessage.addListener(function(e,n,c){return"generateText"===e.action?(function(t){return a.apply(this,arguments)}(e.instruction,e.originalText).then(function(t){c({text:t})}).catch(function(t){console.error("Error generating text:",t),c({error:t.message||"Failed to generate text"})}),!0):"callOpenAI"===e.action?(function(t){return i.apply(this,arguments)}(e.requestData).then(function(){var n=r(t().m(function n(r){var o;return t().w(function(t){for(;;)switch(t.n){case 0:if(!e.streaming){t.n=1;break}c({success:!0}),t.n=3;break;case 1:return t.n=2,r.json();case 2:o=t.v,c({data:o});case 3:return t.a(2)}},n)}));return function(t){return n.apply(this,arguments)}}()).catch(function(t){console.error("Error in callOpenAI:",t),c({error:t.message||"API call failed"})}),!0):"getApiKey"===e.action||"getOpenAIKey"===e.action?(c({apiKey:o}),!0):void 0})})();